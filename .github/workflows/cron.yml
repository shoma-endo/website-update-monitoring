name: Website Update Monitor Cron

on:
  schedule:
    # 1時間に1回実行 (UTC 0分 = 日本時間 毎時0分)
    - cron: '0 * * * *'
  workflow_dispatch: # GitHub Actions の画面から手動で実行できるようにする

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Monitoring API
        run: |
          if [ -z "${{ secrets.VERCEL_APP_URL }}" ]; then
            echo "Error: VERCEL_APP_URL secret is not set."
            exit 1
          fi
          
          # Vercel の API エンドポイントを叩く
          # -f: HTTPエラー時にエラーコードを返す
          # -s: 進捗表示を非表示にする
          curl -fs "${{ secrets.VERCEL_APP_URL }}/api/cron?secret=${{ secrets.CRON_SECRET }}" \
            -o /dev/null \
            -w "HTTP Status: %{http_code}\nTotal Time: %{time_total}s\n"
